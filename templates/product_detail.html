{% extends 'base.html' %}
{% load static %}
{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<style>
    .product-container {
        display: flex;
        gap: 40px;
        margin: 40px;
    }

    .left-panel {
        display: flex;
        gap: 20px;
    }

    .thumbnail-gallery {
        display: flex;
        flex-direction: column;
        gap: 10px;
        max-height: 500px;
        overflow-y: auto;
    }

    .thumbnail-gallery img {
        width: 70px;
        height: 90px;
        object-fit: cover;
        cursor: pointer;
        border: 2px solid #ddd;
        border-radius: 5px;
        transition: border-color 0.3s;
    }

    .thumbnail-gallery img:hover {
        border-color: #ff9900;
    }

    .product-image {
        width: 450px;
        height: auto;
        border: 1px solid #ddd;
        border-radius: 10px;
        padding: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .product-image img {
        width: 100%;
        height: auto;
        object-fit: contain;
    }

    .product-details { flex: 1; }
    .product-title { font-size: 26px; font-weight: bold; margin-bottom: 15px; }
    .product-price { font-size: 24px; color: #B12704; font-weight: bold; margin-bottom: 10px; }
    .product-sale { color: green; font-weight: bold; margin-bottom: 10px; }
    .product-buttons { margin: 20px 0; }

    .btn-amazon, .btn-buy {
        padding: 10px 20px; font-weight: bold; border-radius: 5px; text-decoration: none;
    }

    .btn-amazon {
        background-color: #FFD814;
        border: 1px solid #FCD200;
        color: black;
        margin-right: 10px;
    }

    .btn-buy {
        background-color: #FFA41C;
        color: white;
        border: none;
    }

    .product-info p { margin-bottom: 10px; }

    .about-description {
        overflow: hidden;
        max-height: 3.5em;
        transition: max-height 0.3s ease;
        position: relative;
    }

    .about-description.expanded {
        max-height: 1000px;
    }

    .view-more {
        color: #007185;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
        margin-top: 5px;
        display: inline-block;
    }
    .related-product-name {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    height: 2.8em;
}
.related-products-wrapper {
    display: flex;
    gap: 20px;
    margin: 20px 40px;
    flex-wrap: wrap;
    justify-content: space-between;
}
.related-product-card {
    flex: 1 1 calc(25% - 20px);
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 10px;
    text-align: center;
    max-width: 220px;
}

    
</style>

<div class="product-container">
    <div class="left-panel">
        <!-- Vertical Thumbnail Gallery -->
        <div class="thumbnail-gallery">
            <img src="{{ product.image.url }}" onclick="changeMainImage(this.src)" alt="Main Image">
            {% for img in product.gallery_images.all %}
                <img src="{{ img.image.url }}" onclick="changeMainImage(this.src)" alt="Gallery Image">
            {% endfor %}
        </div>

        <!-- Main Image -->
        <div class="product-image">
            <img id="mainProductImage" src="{{ product.image.url }}" alt="{{ product.name }}">
        </div>
    </div>

    <div class="product-details">
        <h1 class="product-title">{{ product.name }}</h1>

        {% if product.on_sale %}
            <div class="product-price">Rs. <del>{{ product.price }}</del> <strong>{{ product.sale_price }}</strong></div>
            <div class="product-sale">Sale Active ({{ product.sale_start }} to {{ product.sale_end }})</div>
        {% else %}
            <div class="product-price">Rs. {{ product.price }}</div>
        {% endif %}

        <div class="product-stock">In Stock</div>

        <div class="product-buttons">
            <a href="#" class="btn-amazon">Add to Cart</a>
            <a href="{% url 'buy_now' product.id %}" class="btn btn-success">Buy Now</a>

        </div>
        
        <div class="product-info">
            <p><strong>Shipping Rate:</strong> Rs. {{ product.shipping_rate }}</p>
            <p><strong>Category:</strong> {{ product.category.name }}</p>
            <p><strong>Sizes Available:</strong>
                {% for size in product.available_sizes.all %}
                    {{ size.name }}{% if not forloop.last %}, {% endif %}
                {% empty %}
                    N/A
                {% endfor %}
            </p>

            <div class="about-section">
                <h3>About this item</h3>
                <div id="about-desc" class="about-description">{{ product.description }}</div>
                <span id="toggleBtn" class="view-more">View More</span>
            </div>
        </div>
    </div>
</div>
<hr>
<h2 style="margin-left: 40px;">Related Products</h2>
<div class="related-products-wrapper">
    {% for related in related_products|slice:":4" %}
        <div class="related-product-card">
            <a href="{% url 'product_detail' related.id %}">
                <img src="{{ related.image.url }}" alt="{{ related.name }}" style="width: 100%; height: 150px; object-fit: cover;">
                <p class="related-product-name" style="font-weight: bold; margin-top: 10px;">{{ related.name }}</p>
                {% if related.on_sale %}
                    <p style="color: green;"><del>{{ related.price }}</del> Rs. {{ related.sale_price }}</p>
                {% else %}
                    <p>Rs. {{ related.price }}</p>
                {% endif %}
            </a>
        </div>
    {% empty %}
        <p>No related products found.</p>
    {% endfor %}
</div>

<script>
    const desc = document.getElementById("about-desc");
    const toggle = document.getElementById("toggleBtn");
    toggle.addEventListener("click", () => {
        desc.classList.toggle("expanded");
        toggle.textContent = desc.classList.contains("expanded") ? "View Less" : "View More";
    });

    function changeMainImage(src) {
        document.getElementById('mainProductImage').src = src;
    }
</script>
{% endblock %}
